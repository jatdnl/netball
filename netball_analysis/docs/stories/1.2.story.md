# Story 1.2: OCR Core Module Development

## Story Information
- **Epic:** 1 - OCR Jersey Reading Integration
- **Story Number:** 1.2
- **Status:** Draft
- **Priority:** High
- **Estimated Effort:** 4-6 hours

## Story Statement
As a **developer**,
I want **to create the JerseyOCRProcessor module**,
so that **jersey numbers can be recognized from player bounding boxes**.

## Acceptance Criteria
1. Create `core/ocr.py` with `JerseyOCRProcessor` class
2. Implement `process_player_roi()` method for jersey recognition
3. Add confidence scoring for OCR results
4. Include error handling with graceful fallbacks
5. Add comprehensive logging for OCR operations

## Integration Verification
- IV1: OCR module integrates with existing `BoundingBox` type
- IV2: OCR failures do not interrupt existing detection pipeline
- IV3: OCR processing time is logged and monitored

## Dev Notes

### Previous Story Insights
Story 1.1 established the OCR virtual environment with EasyOCR, OpenCV, NumPy, and Pillow dependencies. The environment is isolated from the training environment and ready for OCR module development.

### Data Models
Based on existing project structure analysis:
- **BoundingBox**: Existing type in `core/types.py` - contains x1, y1, x2, y2 coordinates
- **PlayerJerseyData**: New type to be created - contains jersey number, confidence, bbox, timestamp
- **Integration**: OCR module will use existing BoundingBox for input and create PlayerJerseyData for output

### API Specifications
- **JerseyOCRProcessor.process_player_roi(image_roi: np.ndarray, bbox: BoundingBox) -> Optional[int]**
- **JerseyOCRProcessor.get_confidence_score() -> float**
- **JerseyOCRProcessor.configure_ocr_params(config: dict) -> None**

### Component Specifications
- **JerseyOCRProcessor Class**: Main OCR processing class
  - Initialize with EasyOCR reader
  - Process player region of interest (ROI) for jersey numbers
  - Return jersey number with confidence score
  - Handle OCR failures gracefully
  - Log processing time and results

### File Locations
Based on existing project structure:
- **New file**: `core/ocr.py` - JerseyOCRProcessor class
- **Existing file**: `core/types.py` - Add PlayerJerseyData type
- **Integration**: `core/detection.py` - Will integrate OCR processing

### Testing Requirements
- Unit tests for JerseyOCRProcessor class methods
- Integration tests with existing BoundingBox type
- Error handling tests for OCR failures
- Performance tests for OCR processing time
- Mock tests for EasyOCR integration

### Technical Constraints
- Must work with existing CPU-only setup (no GPU dependencies)
- EasyOCR must be configured for optimal performance on jersey numbers
- Processing time must be logged for performance monitoring
- Error handling must prevent OCR failures from breaking detection pipeline
- Must integrate with existing logging patterns

## Tasks / Subtasks

### Task 1: Create PlayerJerseyData Type (AC: 1, IV1)
1. Add `PlayerJerseyData` class to `core/types.py`
2. Include fields: player_id, jersey_number, confidence, bbox, timestamp, recognition_method
3. Add type hints and documentation
4. Ensure compatibility with existing serialization

### Task 2: Create JerseyOCRProcessor Class (AC: 1, 2)
1. Create `core/ocr.py` file
2. Implement `JerseyOCRProcessor` class with EasyOCR initialization
3. Add `process_player_roi()` method for jersey recognition
4. Configure EasyOCR for optimal jersey number recognition
5. Add comprehensive class documentation

### Task 3: Implement Confidence Scoring (AC: 3)
1. Add confidence scoring logic to OCR results
2. Implement `get_confidence_score()` method
3. Add confidence threshold configuration
4. Document confidence scoring methodology

### Task 4: Add Error Handling and Logging (AC: 4, 5, IV2, IV3)
1. Implement try-catch blocks for OCR operations
2. Add graceful fallback for OCR failures
3. Implement comprehensive logging for OCR operations
4. Add processing time monitoring
5. Ensure OCR failures don't interrupt detection pipeline

### Task 5: Configuration Integration (AC: 1)
1. Add `configure_ocr_params()` method
2. Support configuration from existing config system
3. Add OCR parameter validation
4. Document configuration options

### Task 6: Testing and Validation (AC: 1-5, IV1-IV3)
1. Create unit tests for JerseyOCRProcessor
2. Test integration with existing BoundingBox type
3. Test error handling scenarios
4. Test performance monitoring
5. Verify OCR failures don't break detection pipeline

## Testing Strategy
- **Unit Tests**: JerseyOCRProcessor class methods, confidence scoring, error handling
- **Integration Tests**: BoundingBox integration, logging integration
- **Performance Tests**: OCR processing time monitoring
- **Error Tests**: OCR failure scenarios, graceful fallbacks

## Definition of Done
- [ ] JerseyOCRProcessor class created and functional
- [ ] PlayerJerseyData type added to core/types.py
- [ ] process_player_roi() method implemented
- [ ] Confidence scoring implemented
- [ ] Error handling with graceful fallbacks
- [ ] Comprehensive logging for OCR operations
- [ ] Integration with existing BoundingBox type verified
- [ ] All tests passing
- [ ] Documentation updated

## Risk Mitigation
- **Risk**: EasyOCR performance issues
- **Mitigation**: Configure EasyOCR for optimal jersey recognition, monitor processing time
- **Risk**: OCR failures breaking detection pipeline
- **Mitigation**: Comprehensive error handling and graceful fallbacks
- **Risk**: Integration issues with existing types
- **Mitigation**: Thorough testing of BoundingBox integration

## Dependencies
- **Requires**: Story 1.1 (OCR Environment Setup) to be complete
- **Enables**: Story 1.3 (Jersey Data Models), Story 1.6 (Detection Pipeline Integration)

## Dev Agent Record
- **Agent Model Used:** TBD
- **Debug Log References:** TBD
- **Completion Notes:** TBD
- **File List:** TBD
- **Change Log:** TBD





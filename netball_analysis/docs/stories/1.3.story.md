# Story 1.3: Jersey Data Models and Types

## Story Information
- **Epic:** 1 - OCR Jersey Reading Integration
- **Story Number:** 1.3
- **Status:** Draft
- **Priority:** High
- **Estimated Effort:** 2-3 hours

## Story Statement
As a **developer**,
I want **to extend existing data types with jersey information**,
so that **jersey recognition results can be stored and tracked**.

## Acceptance Criteria
1. Add `PlayerJerseyData` class to `core/types.py`
2. Add `PlayerJerseyAnalysis` class for temporal tracking
3. Extend existing `Detection` type with optional jersey fields
4. Maintain backward compatibility with existing data structures
5. Add type hints and documentation

## Integration Verification
- IV1: Existing detection pipeline continues to work without jersey data
- IV2: New jersey types integrate with existing serialization
- IV3: No breaking changes to existing analysis output format

## Dev Notes

### Previous Story Insights
Story 1.2 created the JerseyOCRProcessor class that will generate jersey recognition data. This story establishes the data structures needed to store and track jersey information over time, building the foundation for temporal analysis of jersey recognition results.

### Data Models
Based on existing project structure analysis:
- **Existing Detection type**: Contains bounding box, confidence, class_id - will be extended
- **Existing Player type**: Contains track_id, team, position - will be extended with jersey_number
- **New PlayerJerseyData**: Individual jersey recognition result
  - player_id: str - Links to existing player tracking
  - jersey_number: Optional[int] - Recognized jersey number
  - confidence: float - OCR confidence score
  - bbox: BoundingBox - Region where jersey was detected
  - timestamp: float - Frame timestamp
  - recognition_method: str - OCR engine used
  - team: Optional[Team] - Team assignment from existing TeamIdentifier
- **New PlayerJerseyAnalysis**: Temporal tracking aggregate
  - player_id: str - Player identifier
  - most_likely_jersey: Optional[int] - Most frequently detected number
  - confidence_history: List[float] - Confidence scores over time
  - detection_count: int - Number of successful recognitions
  - first_detection_frame: int - Frame of first detection
  - team: Optional[Team] - Most consistent team assignment

### API Specifications
- **Detection type extension**: Add optional jersey fields without breaking existing interface
- **Serialization compatibility**: Ensure new types work with existing JSON output
- **Type validation**: Add validation for jersey number ranges and confidence scores

### Component Specifications
- **Data Type Extensions**: Extend existing types rather than replace them
- **Backward Compatibility**: All new fields must be optional
- **Serialization Support**: New types must serialize to JSON for analysis output
- **Type Safety**: Add type hints and validation for all new fields

### File Locations
Based on existing project structure:
- **Primary file**: `core/types.py` - Add new data types
- **Integration**: `core/detection.py` - Will use extended Detection type
- **Output**: Analysis output will include jersey data

### Testing Requirements
- Unit tests for new data types
- Serialization tests for JSON compatibility
- Backward compatibility tests for existing Detection usage
- Type validation tests for jersey number ranges
- Integration tests with existing data structures

### Technical Constraints
- Must maintain existing Detection type interface
- All new fields must be optional to preserve backward compatibility
- Jersey numbers should be validated (typically 1-99 range)
- Confidence scores must be 0.0-1.0 range
- Must integrate with existing serialization patterns

## Tasks / Subtasks

### Task 1: Create PlayerJerseyData Type (AC: 1, 5)
1. Add `PlayerJerseyData` class to `core/types.py`
2. Include fields: player_id, jersey_number, confidence, bbox, timestamp, recognition_method
3. Add type hints and validation
4. Add comprehensive documentation
5. Add serialization support

### Task 2: Create PlayerJerseyAnalysis Type (AC: 2, 5)
1. Add `PlayerJerseyAnalysis` class to `core/types.py`
2. Include fields: player_id, most_likely_jersey, confidence_history, detection_count, first_detection_frame
3. Add type hints and validation
4. Add comprehensive documentation
5. Add serialization support

### Task 3: Extend Detection and Player Types (AC: 3, 4)
1. Add optional jersey fields to existing `Detection` type
2. Extend existing `Player` type with jersey_number field
3. Ensure backward compatibility with existing code
4. Add type hints for new fields
5. Update documentation
6. Verify no breaking changes to existing interface

### Task 4: Add Type Validation (AC: 5)
1. Add validation for jersey number ranges (1-99)
2. Add validation for confidence scores (0.0-1.0)
3. Add validation for required fields
4. Add error handling for invalid data
5. Document validation rules

### Task 5: Serialization Integration (AC: 4, IV2)
1. Ensure new types serialize to JSON
2. Test compatibility with existing output format
3. Add serialization tests
4. Verify no breaking changes to existing serialization
5. Document serialization format

### Task 6: Testing and Validation (AC: 1-5, IV1-IV3)
1. Create unit tests for new data types
2. Test backward compatibility with existing Detection usage
3. Test serialization compatibility
4. Test type validation
5. Verify no breaking changes to existing analysis output

## Testing Strategy
- **Unit Tests**: New data type creation, validation, serialization
- **Integration Tests**: Backward compatibility with existing Detection type
- **Serialization Tests**: JSON compatibility with existing output format
- **Validation Tests**: Jersey number ranges, confidence scores
- **Regression Tests**: Existing functionality remains unchanged

## Definition of Done
- [ ] PlayerJerseyData class created and documented
- [ ] PlayerJerseyAnalysis class created and documented
- [ ] Detection type extended with optional jersey fields
- [ ] Backward compatibility maintained
- [ ] Type validation implemented
- [ ] Serialization support added
- [ ] All tests passing
- [ ] Documentation updated
- [ ] No breaking changes to existing code

## Risk Mitigation
- **Risk**: Breaking changes to existing Detection type
- **Mitigation**: All new fields optional, thorough backward compatibility testing
- **Risk**: Serialization incompatibility
- **Mitigation**: Comprehensive serialization testing with existing output format
- **Risk**: Type validation issues
- **Mitigation**: Clear validation rules and error handling

## Dependencies
- **Requires**: Story 1.2 (OCR Core Module Development) to be complete
- **Enables**: Story 1.4 (Jersey Number Tracking System), Story 1.7 (Analysis Output Extension)

## Dev Agent Record
- **Agent Model Used:** TBD
- **Debug Log References:** TBD
- **Completion Notes:** TBD
- **File List:** TBD
- **Change Log:** TBD
